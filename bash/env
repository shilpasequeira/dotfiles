#!/usr/bin/env bash

# --------------------------------------------------------------------------
# Helpers
# --------------------------------------------------------------------------

function __setup_path() {
  local pattern="^|(.*:)$1(:.*)|$"
  if [[ -n $1 && -d $1 && ! $PATH =~ $pattern ]]; then
    PATH=$1:$PATH
  fi
}

function __rvm_is_loaded() {
  if which rvm > /dev/null 2>&1; then
    true
  else
    false
  fi
}

# --------------------------------------------------------------------------
# Common settings
# --------------------------------------------------------------------------

# -- Locale settings -------------------------------------------------------

export LC_ALL=en_US.UTF-8

# -- RVM -------------------------------------------------------------------

if ! __rvm_is_loaded; then
  if [[ -s "$HOME/.rvm/scripts/rvm" ]]; then
    source "$HOME/.rvm/scripts/rvm"
  elif [[ -s "/usr/local/rvm/scripts/rvm" ]]; then
    source "/usr/local/rvm/scripts/rvm"
  else
    echo "RVM not found!"
  fi
fi

[[ -r $rvm_path/scripts/completion ]] && . $rvm_path/scripts/completion

# -- Path settings ---------------------------------------------------------

__setup_path $HOME/bin

# -- Directory colors ------------------------------------------------------

LS_COLORS=""
LS_COLORS=$LS_COLORS:"di=01;36:ln=01;04:ex=01;32:mi=01;30"
LS_COLORS=$LS_COLORS:"*.dmg=01;33:*.rar=01;33:*.tar.gz=01;33:*tar.bz2=01;33"
LS_COLORS=$LS_COLORS:"*.tgz=01;33:*.zip=01;33"
LS_COLORS=$LS_COLORS:"*.c=01;31:*.cpp=01;31:*.h=01;31:*.m=01;31:*.rb=01;31"
LS_COLORS=$LS_COLORS:"*.rb=01;31:*.xcodeproj=01;31"
export LS_COLORS

# -- Word-wise erasing -----------------------------------------------------

stty werase undef
bind '"\C-w":backward-kill-word'

# --------------------------------------------------------------------------
# System specific settings
# --------------------------------------------------------------------------

[[ -f ~/.bash/env.d/$(uname) ]] && source ~/.bash/env.d/$(uname)

# --------------------------------------------------------------------------
# Tear down
# --------------------------------------------------------------------------

unset __setup_path
unset __rvm_is_loaded
